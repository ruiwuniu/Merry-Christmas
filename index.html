<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>香港樹仁大學聖誕賀卡</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+HK:wght@400;700&display=swap');

        :root {
            --vintage-paper: #f4ede0;
            --hksyu-red: #c41e3a;
            --wax-seal-color: #8B0000;
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #0f0a05;
            font-family: 'Noto Serif HK', serif;
        }

        #snow-canvas {
            position: fixed;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 60;
        }

        .room {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: radial-gradient(circle at center, #322015 0%, #0f0a05 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            perspective: 1200px;
        }

        /* AI 壁爐容器 */
        .fireplace-container {
            position: relative;
            width: 90vw;
            max-width: 500px;
            aspect-ratio: 4 / 3;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            margin-bottom: 20px;
            overflow: hidden;
            border-radius: 8px 8px 0 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        #fireplace-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* 信封飛出 */
        .envelope-wrapper {
            position: absolute;
            width: 80vw;
            max-width: 320px;
            aspect-ratio: 320 / 220;
            z-index: 100;
            cursor: pointer;
            transition: all 1.2s cubic-bezier(0.4, 0, 0.2, 1);
            transform: scale(0) translateY(100px);
            opacity: 0;
            pointer-events: none;
            left: 50%;
            margin-left: -40vw;
        }

        @media (min-width: 400px) {
            .envelope-wrapper { margin-left: -160px; }
        }

        .envelope-wrapper.fly-out {
            transform: scale(1) translateY(-5vh) rotate(-3deg);
            opacity: 1;
            pointer-events: auto;
        }

        .envelope {
            position: relative;
            width: 100%;
            height: 100%;
            background: #d4bc94;
            box-shadow: 0 20px 50px rgba(0,0,0,0.6);
            border-radius: 4px;
            transform-style: preserve-3d;
        }

        .envelope-flap {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #c1a77d;
            clip-path: polygon(0 0, 100% 0, 50% 55%);
            transition: transform 0.6s 1s;
            transform-origin: top;
            z-index: 10;
        }

        .open .envelope-flap {
            transform: rotateX(180deg);
            z-index: 1;
        }

        /* 火漆印 */
        .wax-seal {
            position: absolute;
            top: 55%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 70px;
            height: 70px;
            z-index: 20;
            transition: all 0.5s ease-in-out;
        }

        .wax-seal img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.4));
        }

        .open .wax-seal {
            opacity: 0;
            transform: translate(-50%, -50%) scale(1.2);
            filter: blur(10px);
            pointer-events: none;
            transition-delay: 0.2s;
        }

        /* 賀卡 */
        .card {
            position: absolute;
            top: 5%;
            left: 5%;
            width: 90%;
            height: 90%;
            background: white;
            z-index: 5;
            transition: all 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-radius: 2px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .open .card {
            transform: translateY(-12vh) scale(1.1);
            width: 85vw;
            max-width: 360px;
            height: auto;
            aspect-ratio: 3 / 4;
            left: 50%;
            margin-left: -42.5vw;
            box-shadow: 0 30px 60px rgba(0,0,0,0.4);
        }
        @media (min-width: 425px) {
            .open .card { margin-left: -180px; }
        }

        .illustration-container {
            width: 100%;
            height: 55%;
            position: relative;
            background: #1e293b;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        #ai-card-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: none;
            animation: fadeIn 1s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .loader {
            text-align: center;
            color: white;
        }
        .snowball {
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            display: inline-block;
            margin: 0 5px;
            animation: bounce 0.6s infinite alternate;
        }
        .snowball:nth-child(2) { animation-delay: 0.2s; }
        .snowball:nth-child(3) { animation-delay: 0.4s; }

        @keyframes bounce {
            to { transform: translateY(-15px); }
        }

        .greeting-content {
            padding: 15px 20px;
            text-align: center;
            background: var(--vintage-paper);
            flex-grow: 1;
            border-top: 3px solid var(--hksyu-red);
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .title-cn {
            font-family: 'Ma Shan Zheng', cursive;
            color: var(--hksyu-red);
            font-size: 1.6rem;
            margin-bottom: 4px;
        }
        
        .greeting-text {
            font-size: 0.82rem;
            line-height: 1.45;
            color: #4b5563;
        }

        .btn-start {
            margin-top: 15px;
            padding: 12px 40px;
            background: var(--hksyu-red);
            color: white;
            border-radius: 40px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 10px 25px rgba(196, 30, 58, 0.4);
            transition: all 0.3s;
            z-index: 200;
            font-size: 1rem;
        }

        .hidden { display: none; }
    </style>
</head>
<body>

    <canvas id="snow-canvas"></canvas>

    <div class="room">
        <div class="flex flex-col items-center z-10 relative" style="top: -5vh;">
            <div class="fireplace-container">
                <img id="fireplace-image" alt="Vintage Fireplace with Fire" style="display: none;">
                <div id="fireplace-loader" class="loader absolute">
                    <div class="snowball bg-orange-500"></div>
                    <div class="snowball bg-orange-500"></div>
                    <div class="snowball bg-orange-500"></div>
                    <p class="mt-4 text-xs text-orange-300">正在點燃壁爐...</p>
                </div>
            </div>
            <button class="btn-start" id="btn-start">開啟聖誕賀禮</button>
            <p id="loading-hint" class="text-white/50 text-xs mt-4 text-center px-4">AI 正在為您手繪獨特的聖誕卡片...</p>
        </div>

        <div class="envelope-wrapper" id="envelope-wrapper">
            <div class="envelope">
                <div class="envelope-flap"></div>
                
                <div class="wax-seal" id="wax-seal">
                    <img id="wax-seal-image" alt="HKSYU Wax Seal" style="display: none;">
                    <div id="seal-loader" class="loader absolute inset-0 flex items-center justify-center">
                        <div class="w-8 h-8 border-4 border-red-800 border-t-transparent rounded-full animate-spin"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="illustration-container">
                        <div id="card-loader" class="loader">
                            <div class="snowball"></div>
                            <div class="snowball"></div>
                            <div class="snowball"></div>
                            <p class="mt-4 text-xs">正在繪製雪中維港...</p>
                        </div>
                        <img id="ai-card-image" alt="HKSYU Snow View Illustration">
                    </div>

                    <div class="greeting-content">
                        <h2 class="title-cn">聖誕快樂</h2>
                        <p class="text-xs font-bold text-red-800 mb-2">Merry Christmas</p>
                        <div class="greeting-text">
                            <p>從寶馬山俯瞰</p>
                            <p>雪中的維港與北角燈火</p>
                            <p class="mt-1 font-semibold text-red-700">祝您平安喜樂</p>
                            <p class="mt-2 text-[10px] italic">Overlooking the snowy Victoria Harbour<br>from the peaks of Braemar Hill.</p>
                            <p class="text-[10px] italic">Wishing you peace and joy.</p>
                            
                            <p class="mt-3 font-bold text-red-800">香港樹仁大學</p>
                            <p class="text-[10px] font-bold text-gray-500">Hong Kong Shue Yan University</p>
                            <p class="mt-2 text-sm font-semibold text-gray-700 italic border-t border-gray-200 pt-2">Dr. Richard Niu</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const apiKey = "";
        
        const fireplacePrompt = "A magnificent, opulent Baroque-style marble fireplace with a roaring fire. It is richly decorated with gilded carvings, a massive evergreen garland with red ribbons and baubles, antique brass candlesticks, and plush velvet stockings. The scene is warm and luxurious, rendered in a detailed, traditional oil painting style.";
        const waxSealPrompt = "A close-up photograph of a round, dark red wax seal on an envelope. The seal is embossed with the official circular coat of arms logo of Hong Kong Shue Yan University (HKSYU). The wax has a realistic, aged texture.";
        const cardImagePrompt = "A breathtaking children's book illustration from a viewpoint on Braemar Hill, looking down towards North Point and Victoria Harbour in Hong Kong. The entire scene is covered in thick snow. The city lights twinkle warmly, and traditional junk boats are in the snowy harbour. The style is whimsical and hand-painted with soft textures.";

        const canvas = document.getElementById('snow-canvas');
        const ctx = canvas.getContext('2d');
        let width, height, snowflakes;

        function initSnow() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
            snowflakes = Array.from({ length: 150 }, () => ({
                x: Math.random() * width,
                y: Math.random() * height,
                radius: Math.random() * 2.5 + 0.5,
                speed: Math.random() * 1.5 + 0.5,
                opacity: Math.random() * 0.7 + 0.3
            }));
        }

        function drawSnow() {
            ctx.clearRect(0, 0, width, height);
            snowflakes.forEach(flake => {
                ctx.beginPath();
                ctx.fillStyle = `rgba(255, 255, 255, ${flake.opacity})`;
                ctx.arc(flake.x, flake.y, flake.radius, 0, Math.PI * 2);
                ctx.fill();
                flake.y += flake.speed;
                if (flake.y > height) flake.y = -10;
            });
            requestAnimationFrame(drawSnow);
        }

        async function generateImage(prompt, imgId, loaderId, retries = 0) {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        instances: [{ prompt: prompt }],
                        parameters: { sampleCount: 1 }
                    })
                });

                if (!response.ok) throw new Error('API Error');

                const result = await response.json();
                const base64 = result.predictions[0].bytesBase64Encoded;
                const imgElement = document.getElementById(imgId);
                const loader = document.getElementById(loaderId);

                imgElement.src = `data:image/png;base64,${base64}`;
                imgElement.onload = () => {
                    imgElement.style.display = 'block';
                    if (loader) loader.style.display = 'none';
                };
            } catch (error) {
                if (retries < 3) {
                    const delay = Math.pow(2, retries) * 1000;
                    setTimeout(() => generateImage(prompt, imgId, loaderId, retries + 1), delay);
                } else {
                    if (loaderId) document.getElementById(loaderId).innerHTML = "<p class='text-xs'>載入失敗</p>";
                }
            }
        }

        const btnStart = document.getElementById('btn-start');
        const wrapper = document.getElementById('envelope-wrapper');
        const loadingHint = document.getElementById('loading-hint');

        btnStart.addEventListener('click', () => {
            btnStart.classList.add('hidden');
            loadingHint.classList.add('hidden');
            wrapper.classList.add('fly-out');
        });

        wrapper.addEventListener('click', (e) => {
            if (wrapper.classList.contains('fly-out') && !wrapper.classList.contains('open')) {
                wrapper.classList.add('open');
            }
            else if (wrapper.classList.contains('open') && e.target === wrapper) {
                wrapper.classList.remove('open');
                setTimeout(() => {
                    wrapper.classList.remove('fly-out');
                    btnStart.classList.remove('hidden');
                    loadingHint.classList.remove('hidden');
                }, 800);
            }
        });

        window.onload = async () => {
            initSnow();
            drawSnow();
            
            generateImage(fireplacePrompt, 'fireplace-image', 'fireplace-loader');
            generateImage(waxSealPrompt, 'wax-seal-image', 'seal-loader');
            generateImage(cardImagePrompt, 'ai-card-image', 'card-loader');

            loadingHint.innerText = "畫卷已繪就，請開啟祝福";
        };
        window.onresize = initSnow;
    </script>
</body>
</html>